{"version":3,"file":"ng-util-lazy.umd.js","sources":["../../../../packages/lazy/lazy.service.ts"],"sourcesContent":["import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { filter, share } from 'rxjs/operators';\n\nexport interface NuLazyResult {\n  path: string;\n  status: 'ok' | 'error' | 'loading';\n  error?: {};\n}\n\n@Injectable({ providedIn: 'root' })\nexport class NuLazyService {\n  private list: { [key: string]: boolean } = {};\n  private cached: { [key: string]: NuLazyResult } = {};\n  private _notify: BehaviorSubject<NuLazyResult[]> = new BehaviorSubject<NuLazyResult[]>([]);\n\n  constructor(@Inject(DOCUMENT) private doc: any) {}\n\n  get change(): Observable<NuLazyResult[]> {\n    return this._notify.asObservable().pipe(\n      share(),\n      filter(ls => ls.length !== 0),\n    );\n  }\n\n  clear(): void {\n    this.list = {};\n    this.cached = {};\n  }\n\n  load(paths: string | string[]): Promise<NuLazyResult[]> {\n    if (!Array.isArray(paths)) {\n      paths = [paths];\n    }\n\n    const promises: Array<Promise<NuLazyResult>> = [];\n    paths.forEach(path => {\n      if (path.endsWith('.js')) {\n        promises.push(this.loadScript(path));\n      } else {\n        promises.push(this.loadStyle(path));\n      }\n    });\n\n    return Promise.all(promises).then(res => {\n      this._notify.next(res);\n      return Promise.resolve(res);\n    });\n  }\n\n  loadScript(path: string, options?: { innerContent?: string }): Promise<NuLazyResult> {\n    const { innerContent } = { ...options };\n    return new Promise(resolve => {\n      if (this.list[path] === true) {\n        resolve({ ...this.cached[path], status: 'loading' });\n        return;\n      }\n\n      this.list[path] = true;\n      const onSuccess = (item: NuLazyResult) => {\n        this.cached[path] = item;\n        resolve(item);\n        this._notify.next([item]);\n      };\n\n      const node = this.doc.createElement('script') as any;\n      node.type = 'text/javascript';\n      node.src = path;\n      node.charset = 'utf-8';\n      if (innerContent) {\n        node.innerHTML = innerContent;\n      }\n      if (node.readyState) {\n        // IE\n        node.onreadystatechange = () => {\n          if (node.readyState === 'loaded' || node.readyState === 'complete') {\n            node.onreadystatechange = null;\n            onSuccess({\n              path,\n              status: 'ok',\n            });\n          }\n        };\n      } else {\n        node.onload = () =>\n          onSuccess({\n            path,\n            status: 'ok',\n          });\n      }\n      node.onerror = (error: {}) =>\n        onSuccess({\n          path,\n          status: 'error',\n          error,\n        });\n      this.doc.getElementsByTagName('head')[0].appendChild(node);\n    });\n  }\n\n  loadStyle(path: string, options?: { rel?: string; innerContent?: string }): Promise<NuLazyResult> {\n    const { rel, innerContent } = { rel: 'stylesheet', ...options };\n    return new Promise(resolve => {\n      if (this.list[path] === true) {\n        resolve(this.cached[path]);\n        return;\n      }\n\n      this.list[path] = true;\n\n      const node = this.doc.createElement('link') as HTMLLinkElement;\n      node.rel = rel;\n      node.type = 'text/css';\n      node.href = path;\n      if (innerContent) {\n        node.innerHTML = innerContent;\n      }\n      this.doc.getElementsByTagName('head')[0].appendChild(node);\n      const item: NuLazyResult = {\n        path,\n        status: 'ok',\n      };\n      this.cached[path] = item;\n      resolve(item);\n    });\n  }\n}\n"],"names":["BehaviorSubject","share","filter","Injectable","Inject","DOCUMENT"],"mappings":"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"}