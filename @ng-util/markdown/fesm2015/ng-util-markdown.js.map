{"version":3,"file":"ng-util-markdown.js","sources":["../../../../../packages/markdown/markdown.config.ts","../../../../../packages/markdown/markdown.service.ts","../../../../../packages/markdown/markdown.component.ts","../../../../../packages/markdown/markdown.module.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\nexport const NU_MARKDOWN_CONFIG = new InjectionToken('NU_MARKDOWN_CONFIG');\n\nexport interface NuMarkdownConfig {\n  /**\n   * The base URL to [Vditor](https://github.com/Vanessa219/vditor) library, Default: `['https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js', 'https://cdn.jsdelivr.net/npm/vditor/dist/index.css']`\n   */\n  libs?: string[];\n\n  /**\n   * Equar [IOptions](https://github.com/Vanessa219/vditor/blob/master/types/index.d.ts#L432)\n   */\n  defaultOptions?: any;\n}\n","import { Inject, Injectable } from '@angular/core';\nimport { NuLazyService } from '@ng-util/lazy';\nimport { Observable, Subject } from 'rxjs';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\n\n@Injectable({ providedIn: 'root' })\nexport class NuMarkdownService {\n  private libs: string[];\n  private loading = false;\n  private loaded = false;\n  private notify$ = new Subject<void>();\n\n  get notify(): Observable<void> {\n    return this.notify$.asObservable();\n  }\n\n  constructor(@Inject(NU_MARKDOWN_CONFIG) config: NuMarkdownConfig, private lazySrv: NuLazyService) {\n    this.libs = config?.libs || [\n      `https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js`,\n      `https://cdn.jsdelivr.net/npm/vditor/dist/index.css`,\n    ];\n  }\n\n  load(): this {\n    if (this.loading) {\n      if (this.loaded) {\n        this.notify$.next();\n      }\n      return this;\n    }\n    this.loading = true;\n\n    const libs = this.libs!;\n    this.lazySrv.monitor(libs).subscribe(() => {\n      this.loaded = true;\n      this.notify$.next();\n    });\n    this.lazySrv.load(libs);\n\n    return this;\n  }\n}\n","import {\n  AfterViewInit,\n  ChangeDetectionStrategy,\n  Component,\n  ElementRef,\n  EventEmitter,\n  forwardRef,\n  Inject,\n  Input,\n  NgZone,\n  OnDestroy,\n  Output,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { InputNumber } from '@ng-util/util/convert';\nimport { Subscription } from 'rxjs';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\nimport { NuMarkdownService } from './markdown.service';\n\ndeclare var Vditor: any;\n\n@Component({\n  selector: 'nu-markdown',\n  template: ``,\n  exportAs: 'nuMarkdown',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => NuMarkdownComponent),\n      multi: true,\n    },\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NuMarkdownComponent implements ControlValueAccessor, AfterViewInit, OnDestroy {\n  get instance(): any {\n    return this._instance;\n  }\n\n  constructor(\n    protected el: ElementRef<HTMLElement>,\n    @Inject(NU_MARKDOWN_CONFIG) private config: NuMarkdownConfig,\n    private srv: NuMarkdownService,\n    protected ngZone: NgZone,\n  ) {\n    this.notify$ = this.srv.notify.subscribe(() => this.initDelay());\n  }\n\n  private notify$: Subscription;\n  private _instance: any;\n  private _value: string;\n  @Input() options: any;\n  @Input() disabled: boolean;\n  @Input() @InputNumber() delay: number;\n  @Output() ready = new EventEmitter<any>();\n  private onChange = (_: string) => {};\n\n  private initDelay(): void {\n    setTimeout(() => this.init(), this.delay);\n  }\n\n  private init(): void {\n    this.ngZone.runOutsideAngular(() => {\n      const options = {\n        value: this._value,\n        cache: {\n          enable: false,\n        },\n        mode: 'sv',\n        minHeight: 350,\n        input: (value: string) => {\n          this.ngZone.run(() => {\n            this._value = value;\n            this.onChange(value);\n          });\n        },\n        ...this.config?.defaultOptions,\n        ...this.options,\n      };\n      this._instance = new Vditor(this.el.nativeElement, options);\n      this.ready.emit(this._instance);\n    });\n  }\n\n  private setDisabled(): void {\n    if (!this.instance) {\n      return;\n    }\n    if (this.disabled) {\n      this.instance.disabled();\n    } else {\n      this.instance.enable();\n    }\n  }\n\n  writeValue(value: string): void {\n    this._value = value || '';\n    if (this.instance) {\n      this.instance.setValue(this._value);\n    }\n  }\n\n  registerOnChange(fn: (_: string) => void): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(_: () => void): void {}\n\n  setDisabledState(_isDisabled: boolean): void {\n    this.disabled = _isDisabled;\n    this.setDisabled();\n  }\n\n  ngAfterViewInit(): void {\n    if ((window as any).QRious) {\n      this.initDelay();\n      return;\n    }\n    this.srv.load();\n  }\n\n  ngOnDestroy(): void {\n    this.notify$.unsubscribe();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { NuMarkdownComponent } from './markdown.component';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\n\nconst COMPONENTS = [NuMarkdownComponent];\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class NuMarkdownModule {\n  static forRoot(config?: NuMarkdownConfig): ModuleWithProviders<NuMarkdownModule> {\n    return {\n      ngModule: NuMarkdownModule,\n      providers: [{ provide: NU_MARKDOWN_CONFIG, useValue: config }],\n    };\n  }\n}\n"],"names":[],"mappings":"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"}