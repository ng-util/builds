{"version":3,"file":"ng-util-markdown.js","sources":["../../../../packages/markdown/markdown.config.ts","../../../../packages/markdown/markdown.service.ts","../../../../packages/markdown/markdown-base.component.ts","../../../../packages/markdown/markdown-preview.component.ts","../../../../packages/markdown/markdown.component.ts","../../../../packages/markdown/markdown.module.ts","../../../../packages/markdown/ng-util-markdown.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\nexport const NU_MARKDOWN_CONFIG = new InjectionToken('NU_MARKDOWN_CONFIG');\n\nexport interface NuMarkdownConfig {\n  /**\n   * The base URL to [Vditor](https://github.com/Vanessa219/vditor) library, Default: `['https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js', 'https://cdn.jsdelivr.net/npm/vditor/dist/index.css']`\n   */\n  libs?: string[];\n\n  /**\n   * Equar [IOptions](https://github.com/Vanessa219/vditor/blob/master/types/index.d.ts#L432)\n   */\n  defaultOptions?: any;\n}\n","import { Inject, Injectable } from '@angular/core';\nimport { NuLazyService } from '@ng-util/lazy';\nimport { Observable, Subject } from 'rxjs';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\n\n@Injectable({ providedIn: 'root' })\nexport class NuMarkdownService {\n  private libs: string[];\n  private loading = false;\n  private loaded = false;\n  private notify$ = new Subject<void>();\n\n  get notify(): Observable<void> {\n    return this.notify$.asObservable();\n  }\n\n  constructor(@Inject(NU_MARKDOWN_CONFIG) config: NuMarkdownConfig, private lazySrv: NuLazyService) {\n    this.libs = config?.libs || [\n      `https://cdn.jsdelivr.net/npm/vditor/dist/index.min.js`,\n      `https://cdn.jsdelivr.net/npm/vditor/dist/index.css`,\n    ];\n  }\n\n  load(): this {\n    if (this.loading) {\n      if (this.loaded) {\n        this.notify$.next();\n      }\n      return this;\n    }\n    this.loading = true;\n\n    const libs = this.libs!;\n    this.lazySrv.monitor(libs).subscribe(() => {\n      this.loaded = true;\n      this.notify$.next();\n    });\n    this.lazySrv.load(libs);\n\n    return this;\n  }\n}\n","import { AfterViewInit, Directive, ElementRef, EventEmitter, Inject, Input, NgZone, OnDestroy, Output } from '@angular/core';\nimport { InputNumber } from '@ng-util/util/convert';\nimport { Subscription } from 'rxjs';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\nimport { NuMarkdownService } from './markdown.service';\n\n@Directive()\nexport abstract class NuMarkdownBaseComponent implements AfterViewInit, OnDestroy {\n  private notify$: Subscription;\n  protected _instance: any;\n\n  @Input() @InputNumber() delay = 0;\n  @Input() disabled = false;\n  @Input() options: any;\n  @Output() ready = new EventEmitter<string>();\n\n  protected _value!: string;\n  @Input()\n  set value(v: string) {\n    this._value = v;\n    if (this.loaded) {\n      this.init();\n    }\n  }\n\n  get instance(): any {\n    return this._instance;\n  }\n\n  constructor(\n    protected el: ElementRef<HTMLElement>,\n    @Inject(NU_MARKDOWN_CONFIG) protected config: NuMarkdownConfig,\n    protected srv: NuMarkdownService,\n    protected ngZone: NgZone,\n  ) {\n    this.notify$ = this.srv.notify.subscribe(() => this.initDelay());\n  }\n\n  private initDelay(): void {\n    setTimeout(() => this.init(), this.delay);\n  }\n\n  protected abstract init(): void;\n\n  protected get loaded(): boolean {\n    return !!(window as any).Vditor;\n  }\n\n  ngAfterViewInit(): void {\n    if (this.loaded) {\n      this.initDelay();\n      return;\n    }\n    this.srv.load();\n  }\n\n  ngOnDestroy(): void {\n    this.notify$.unsubscribe();\n  }\n}\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\nimport { NuMarkdownBaseComponent } from './markdown-base.component';\n\ndeclare var Vditor: any;\n\n@Component({\n  selector: 'nu-markdown-preview',\n  template: ``,\n  exportAs: 'nuMarkdownPreview',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NuMarkdownPreviewComponent extends NuMarkdownBaseComponent {\n  protected init(): void {\n    this.ngZone.runOutsideAngular(async () => {\n      await Vditor.preview(this.el.nativeElement, this._value);\n      console.log(this.el.nativeElement.innerHTML);\n      this.ngZone.run(() => this.ready.emit(this.el.nativeElement.innerHTML));\n    });\n  }\n}\n","import { ChangeDetectionStrategy, Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { NuMarkdownBaseComponent } from './markdown-base.component';\n\ndeclare var Vditor: any;\n\n@Component({\n  selector: 'nu-markdown',\n  template: ``,\n  exportAs: 'nuMarkdown',\n  providers: [\n    {\n      provide: NG_VALUE_ACCESSOR,\n      useExisting: forwardRef(() => NuMarkdownComponent),\n      multi: true,\n    },\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NuMarkdownComponent extends NuMarkdownBaseComponent implements ControlValueAccessor {\n  private onChange = (_: string) => {};\n\n  protected init(): void {\n    this.ngZone.runOutsideAngular(() => {\n      const options = {\n        value: this._value,\n        cache: {\n          enable: false,\n        },\n        mode: 'sv',\n        minHeight: 350,\n        input: (value: string) => {\n          this.ngZone.run(() => {\n            this._value = value;\n            this.onChange(value);\n          });\n        },\n        ...this.config?.defaultOptions,\n        ...this.options,\n      };\n      this._instance = new Vditor(this.el.nativeElement, options);\n      this.ngZone.run(() => this.ready.emit(this._instance));\n    });\n  }\n\n  private setDisabled(): void {\n    if (!this.instance) {\n      return;\n    }\n    if (this.disabled) {\n      this.instance.disabled();\n    } else {\n      this.instance.enable();\n    }\n  }\n\n  writeValue(value: string): void {\n    this._value = value || '';\n    if (this.instance) {\n      this.instance.setValue(this._value);\n    }\n  }\n\n  registerOnChange(fn: (_: string) => void): void {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(_: () => void): void {}\n\n  setDisabledState(_isDisabled: boolean): void {\n    this.disabled = _isDisabled;\n    this.setDisabled();\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { ModuleWithProviders, NgModule } from '@angular/core';\nimport { NuMarkdownPreviewComponent } from './markdown-preview.component';\nimport { NuMarkdownComponent } from './markdown.component';\nimport { NuMarkdownConfig, NU_MARKDOWN_CONFIG } from './markdown.config';\n\nconst COMPONENTS = [NuMarkdownComponent, NuMarkdownPreviewComponent];\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: COMPONENTS,\n  exports: COMPONENTS,\n})\nexport class NuMarkdownModule {\n  static forRoot(config?: NuMarkdownConfig): ModuleWithProviders<NuMarkdownModule> {\n    return {\n      ngModule: NuMarkdownModule,\n      providers: [{ provide: NU_MARKDOWN_CONFIG, useValue: config }],\n    };\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}